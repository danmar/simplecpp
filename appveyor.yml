version: 1.{build}

environment:
  matrix:
    - VisualStudio: 14.0
      VisualStudioGenerator: "14 2015"
      ConfigurationPlatform: "Win32"
      configuration: "Debug"
      PlatformToolset: "v140"
      vcvars_call: "\"C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\vcvarsall.bat\" x86"
    - VisualStudio: 14.0
      VisualStudioGenerator: "14 2015"
      ConfigurationPlatform: "x64"
      configuration: "Debug"
      PlatformToolset: "v140"
      vcvars_call: "\"C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\vcvarsall.bat\" x64"
    - VisualStudio: 2017
      VisualStudioGenerator: "15 2017"
      ConfigurationPlatform: "Win32"
      configuration: "Debug"
      PlatformToolset: "v141"
      vcvars_call: "C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Community\\VC\\Auxiliary\\Build\\vcvars32.bat"
    - VisualStudio: 2017
      VisualStudioGenerator: "15 2017"
      ConfigurationPlatform: "x64"
      configuration: "Debug"
      PlatformToolset: "v141"
      vcvars_call: "C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Community\\VC\\Auxiliary\\Build\\vcvars64.bat"
    - VisualStudio: 2019
      VisualStudioGenerator: "16 2019"
      ConfigurationPlatform: "Win32"
      configuration: "Debug"
      PlatformToolset: "v142"
      vcvars_call: "C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\VC\\Auxiliary\\Build\\vcvars32.bat"
    - VisualStudio: 2019
      VisualStudioGenerator: "16 2019"
      ConfigurationPlatform: "x64"
      configuration: "Debug"
      PlatformToolset: "v142"
      vcvars_call: "C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\Community\\VC\\Auxiliary\\Build\\vcvars64.bat"

build_script:
  - ECHO Building %configuration% %platform% with MSVC %VisualStudio% (Visual Studio %VisualStudioGenerator%) using %PlatformToolset% PlatformToolset
  - 'CALL "%vcvars_call%"'
  - cmake -DCMAKE_COMPILE_WARNING_AS_ERROR=On -G "Visual Studio %VisualStudioGenerator%" -A %ConfigurationPlatform% .
  - set _CL_=/WX
  - msbuild "simplecpp.sln" /consoleloggerparameters:Verbosity=minimal /target:Build /property:Configuration="%configuration%";Platform=%ConfigurationPlatform% /p:PlatformToolset=%PlatformToolset% /maxcpucount /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll"

test_script:
  - debug\testrunner.exe
  - debug\simplecpp.exe simplecpp.cpp -e
